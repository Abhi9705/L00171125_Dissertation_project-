name: frontend-master workflow

on: 
  push:
    branches:
      - dev-L00171125-Abhishek-DGW-132
  pull_request:
    types:
      - "opened"
jobs:
  Build_docker_FrontendImage:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout codes
        uses: actions/checkout@v4
      - name: Sign in to Docker Hub
        run: docker login -u ${{ secrets.DOCKER_USERNAME }} -p ${{secrets.DOCKER_PASSWORD}} 
      - name: Deleting old Images 
        run: |
         docker rmi -f $(docker image ls -a -q)
      - name: Build Docker Frontend Images
        run: |
         cd /home/runner/work/DevOps2023-2024-Group3/DevOps2023-2024-Group3/WWA-frontend-master
         docker build -t wwag3/wednesdaywickedadventures:latest . 
      - name: Build Docker Backend Images
        run: |
         cd /home/runner/work/DevOps2023-2024-Group3/DevOps2023-2024-Group3/WWA-backend-master
         docker build -t wwag3/wednesdaywickedadventures:backend . 
      - name: Publish Image to docker Hub
        run: |
          docker push wwag3/wednesdaywickedadventures:latest
          docker push wwag3/wednesdaywickedadventures:backend

  Pulling_docker_image:
    runs-on: self-hosted
    needs: Build_docker_FrontendImage
    steps:
      - name: Deleting old contanier 
        run: |
         sudo docker rm -f wwafrontendapp
         sudo docker rm -f wwabackendapp

      - name: pulling frontend image from docker hub 
        run: sudo docker pull wwag3/wednesdaywickedadventures:latest
  
      - name: pulling frontend image from docker hub
        run: sudo docker pull wwag3/wednesdaywickedadventures:backend 

      - name: building backend container
        run: sudo docker run --name wwabackendapp -p 5000:5000 -d  wwag3/wednesdaywickedadventures:backend


      - name: building frontend container
        run: sudo docker run --name wwafrontendapp -p 3000:3000 -d  wwag3/wednesdaywickedadventures:latest

 # sudo docker system prune --all --force --volumes
 



   